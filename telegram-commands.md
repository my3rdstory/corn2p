# 텔레그램 명령어 가이드

Corn2P 텔레그램 봇이 제공하는 명령어와 사용 방법을 정리했습니다. 대부분의 명령은 Discord 역할 인증을 통과한 계정만 실행할 수 있도록 `withAuth`가 적용되어 있으니, 먼저 `/auth`로 인증 절차를 완료한 뒤 이용하세요. 모든 명령은 개인 채팅에서 사용하는 것을 기준으로 하며, 일부 명령은 자동 안내 버튼을 눌렀을 때 `_` 뒤에 거래 ID(8자리 16진수)가 붙은 형태로 전달됩니다.

- `[필수]`는 필수 파라미터, `(선택)`은 선택 파라미터를 의미합니다.
- `@봇이름`을 붙인 텔레그램 슬래시 명령도 동일하게 동작합니다.

## 공통 및 인증
| 명령어 | 파라미터 | 권한 | 설명 |
| --- | --- | --- | --- |
| `/auth` | - | 전체 | Discord 필수 역할 인증용 일회용 코드를 발급하고 절차를 안내합니다. (`src/bot-commands/handlers/auth.ts`) |
| `/help` | - | 인증 필요 | 이용 가이드와 명령어 설명 링크를 반환합니다. |
| `/chatid` | - | 인증 필요 | 현재 채팅의 `chat_id` 값을 알려줍니다. |
| `/myinfo` | - | 인증 필요 | 등록된 구매자/판매자 정보를 요약하고 미처리 거래를 리마인드합니다. |
| `/price` | - | 인증 필요 | 최신 BTC 시세 정보를 HTML 형식으로 안내합니다. |
| `/list` | - | 인증 필요 | 현재 판매자 목록을 안내합니다. |
| `/pricelist` | - | 인증 필요 | 시세 정보와 판매자 목록을 함께 보여줍니다. |
| `/tradeinfo` | `[거래ID\|입금자명]` | 인증 필요 | 거래 ID 또는 입금자명(인증 메모)으로 거래 상세를 조회합니다. |
| `/sellerinfo` | `[판매자닉네임]` | 인증 필요 | 공개 판매자 정보를 조회합니다. 숨김 처리된 판매자는 제외됩니다. |
| `/coffee` | - | 인증 필요 | 1,000 sats Blink 인보이스를 생성하여 후원 링크·QR을 제공합니다. |
| `/candy` | - | 인증 필요 | 300 sats Blink 인보이스를 생성하여 후원 링크·QR을 제공합니다. |

## 구매자 등록 및 주문
| 명령어 | 파라미터 | 설명 |
| --- | --- | --- |
| `/newbuyer` | `[라이트닝주소]` | 이메일 형식의 라이트닝 주소를 등록해 구매자로 가입합니다. 이미 등록된 주소나 형식 오류를 검증합니다. |
| `/buy` | `[판매자닉] (₩금액)` | 특정 판매자에게 지정 금액 또는 기본 최대 금액으로 구매 주문을 생성합니다. 금액을 생략하면 판매자의 최대 판매 한도를 사용합니다. |
| `/deletebuyer` | - | 등록된 구매자 정보를 삭제합니다. |
| `/deletetrade` | `[거래ID\|입금자명]` | 원화 입금이 완료되지 않은 구매 거래를 취소합니다. |
| `/deletetrade_<id>` | 자동 | KRW 입금 만료 후 제공되는 버튼으로, 해당 거래를 취소합니다. |
| `/<금액>` | `[정수]` | 예: `/10000`, `/300000`. 원하는 구매 금액(₩)을 곧바로 입력하면 조건을 만족하는 판매자에게 자동으로 주문합니다. 최소/최대 한도를 벗어나면 거절됩니다. |
| `/<번호>` | `[1~…] (₩금액)` | 판매자 목록 메시지에서 제공되는 순번 단축 명령입니다. 예: `/1`, `/2 50000`, `/3_150000`. 선택한 판매자에게 지정 금액으로 주문합니다. |
| `/buyerinfo` | `[라이트닝주소]` | 특정 라이트닝 주소로 등록된 구매자 정보를 조회합니다. 판매자 검증용으로 사용됩니다. |

## 판매자 등록 및 정보 관리
| 명령어 | 파라미터 | 설명 |
| --- | --- | --- |
| `/newseller` | `[이름] [프리미엄%] [지갑API키] [PushBullet키] [은행/계좌/예금주] [연락주소]` | 안드로이드 판매자 등록. 입력이 누락되면 필요 항목을 안내하며, 지갑·푸시·계좌 형식과 중복 이름을 검증합니다. |
| `/newselleriphone` | `[이름] [프리미엄%] [지갑API키] [은행/계좌/예금주] [연락주소]` | iOS 판매자 등록. PushBullet 없이 즉시 활성화됩니다. |
| `/deleteseller` | - | 내 판매자 정보를 삭제하고, 등록된 PushBullet 웹소켓을 해제합니다. |
| `/hideme` | - | 판매자 목록에 내 정보를 숨깁니다. |
| `/showme` | - | 숨김 상태를 해제합니다. |
| `/editp` | `[프리미엄%]` | 내 판매 프리미엄을 변경합니다. ±MAX_PREMIUM 범위와 소수점 2자리 제한이 적용됩니다. |
| `/editcontact` | `[연락처URL]` | 연락처(텔레그램/오픈카톡 링크 등)를 업데이트합니다. |
| `/editaccount` | `[은행/계좌/예금주]` 또는 `[은행] [계좌] [예금주]` | 입금 계좌 정보를 수정합니다. 슬래시(`/`) 2개로 구분된 형식을 검증합니다. |
| `/newbuyer` | `[라이트닝주소]` | 판매자도 동일 명령으로 자체 테스트/구매자 등록이 가능합니다. |

## 거래 처리 (판매자 중심)
| 명령어 | 파라미터 | 설명 |
| --- | --- | --- |
| `/tradesNotPaid` | - | 내 계정에서 비트코인을 아직 전송하지 않은 거래 목록을 출력합니다. |
| `/tnp` | - | `/tradesNotPaid` 단축 명령. |
| `/confirmkrw_<id>` | 자동 | 원화 입금 확인 후 보여지는 버튼. 입금 확인 여부를 묻고 다음 단계(`/confirmkrwandsendsats_<id>`)를 안내합니다. |
| `/confirmkrwandsendsats_<id>` | 자동 | 입금 완료 표시와 함께 지갑을 통해 비트코인을 전송하고 정산 절차를 진행합니다. |
| `/deletetradenotpaid_<id>` | 자동 | 입금 기한을 초과한 거래를 삭제합니다(생성 후 `KRW_DEPOSIT_EXPIRE_ALARM`분 경과 필요). |
| `/confirmsatssended_<id>` | 자동 | 비트코인 수동 전송을 완료한 뒤 정산을 마무리할 때 사용합니다. 필요 시 관리자도 실행할 수 있습니다. |
| `/confirmkrw` | `[거래ID]` | 거래 ID를 직접 입력해 위와 동일한 입금 확인 과정을 수동으로 시작합니다. |

## 관리자 전용
아래 명령은 `CHAT_ID.admin`으로 설정된 관리자 계정에서만 동작합니다.

| 명령어 | 파라미터 | 설명 |
| --- | --- | --- |
| `/adminwslist` | - | 활성화된 PushBullet 웹소켓 세션 목록을 조회합니다. |
| `/adminallsellers` | - | 모든 판매자의 프리미엄, 잔액, 누적 실적을 요약합니다. |
| `/adminallbuyers` | - | 모든 구매자 리스트 및 비활성 대상(`/admindeletebuyer_<chatId>`)을 표시합니다. |
| `/adminalltrades` | - | 전체 거래 내역을 페이지 단위로 출력합니다. |
| `/adminTradesNotPaid` | - | 입금 미완료 또는 전송 미완료 거래만 필터링해 보여줍니다. |
| `/atnp` | - | `/adminTradesNotPaid` 단축 명령. |
| `/admindeletetrade` | `[거래ID\|입금자명]` | 특정 거래를 강제로 삭제합니다. |
| `/admindeleteseller` | `[판매자닉]` | 마지막 거래 이후 `SELLER_NO_TRADE_LIMIT`일이 지난 판매자를 삭제합니다. |
| `/admineditp` | `[판매자닉] [프리미엄%]` | 특정 판매자의 프리미엄을 조정하고 알림을 보냅니다. |
| `/adminhideme` | `[판매자닉]` | 해당 판매자를 숨김 처리합니다. |
| `/admindeletebuyer` | `[라이트닝주소\|chatId]` | `BUYER_NO_TRADE_LIMIT`일 이상 거래가 없는 구매자를 삭제합니다. |
| `/admindeletebuyer_<chatId>` | 자동 | `/adminallbuyers` 결과에서 제공되는 단축 삭제 명령입니다. |
| `/admincleartradecompleted` | - | 입금·출금이 모두 완료된 거래 기록을 일괄 삭제합니다. |
| `/admincleartradenotpaid` | - | 생성 후 3일 이상 지난 원화 미입금 거래를 일괄 삭제합니다. |
| `/admindeletetrade_<id>` | 자동 | 거래 리스트에서 제공되는 삭제 단축 명령입니다. |

## 빠른 참고
- 봇이 자동으로 보내는 버튼이나 링크는 대부분 위 표에 소개된 명령을 기반으로 `_거래ID` 등을 붙여 실행합니다.
- 오류나 예외 상황이 발생하면 동일 명령을 다시 실행하기 전에 `/myinfo`, `/tradesNotPaid`, `/tradeinfo`로 현재 상태를 재확인하는 것이 안전합니다.
- 추가 환경 설정은 `src/bot-commands/index.ts`와 개별 핸들러 파일에서 확인할 수 있습니다.

